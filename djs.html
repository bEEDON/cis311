<!DOCTYPE html>
<html lang="en">
<head>

<title>bronco functions</title>

<script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.18.min.js"></script>
<script id="facebook-jssdk" src="https://connect.facebook.net/en_US/all.js"></script>
<meta charset="UTF-8">

<meta
	http-equiv="X-UsA-Compatible"
	content="IE=edge"
><meta
	name="viewport"
	content="width=device-width, initial-scale=1"
>
<link
	rel="stylesheet"
	href="css/bootstrap.min.css"
>
<link
	rel="stylesheet"
	href="css/styles.css"
>


<!-- ----------------------------------------------NAVBAR------------------------------------ -->

</head>
<body class="bgimagepage">



	<div class="content container">

		<div class="row ">

			<section class="col-xs-12">


				<nav class="bgimage navbar navbar-default navbar-fixed-top">
					<div class="container">
						<ul class="nav navbar-nav">


<li >
<button class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn" 

onclick="location.href='indexara.html'">Home
</button>

</li>


							<li class="dropdown">

								<button
									type="button"
									data-toggle="dropdown"
									id="About"
									aria-haspopup="true"
									aria-expanded="true"
									class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn"
								>
									About <span class="caret"></span>

								</button>

								<ul
									class="dropdown-menu"
									aria-labelledby="About"
								>

									<li class="dropdown-header"></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/brendonq/Website/about.html">About Us</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/brendonq/Website/legal.html">Legal</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/brendonq/Website/faq.html">FAQ</a></li>

								</ul>
							</li>
							<li class="dropdown">

								<button
									type="button"
									data-toggle="dropdown"
									id="Category"
									aria-haspopup="true"
									aria-expanded="true"
									class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn"
								>
									Go To <span class="caret"></span>

								</button>

								<ul
									class="dropdown-menu"
									aria-labelledby="Category"
								>
									<li class="dropdown-header">What are you looking for?</li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cis311project/facebook-191472921314303/Tonight.html">Tonight</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cis311project/facebook-191472921314303/Upcoming.html">Tomorrow</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cis311project/facebook-191472921314303/Concerts.html">Concerts</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cis311project/facebook-191472921314303/BarsClubs.html">Bars / Clubs</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisstuff/HouseParties.html">House Parties</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisstuff/PoolParties.html">Pool Parties</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisstuff/Even+Ratio.html">Even Ratio</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisstuff/21andOver.html">21 N Over</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisproject/membersOnlyPage.html">Members Only</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisproject/secretPage.html">? Secret</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisproject/proofPage.html">Proof</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisproject/mapsPage.html">Map</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/aracis311/broncofunctions/hosts.html">Hosts</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/cisproject/secretPage.html">Security</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/aracis311/broncofunctions/djs.html">DJs</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/aracis311/broncofunctions/chat.html">Chat</a></li>
								</ul>

							</li>

							<li>

								<button
									type="button"
									data-toggle="dropdown"
									id="Podcast"
									aria-haspopup="true"
									aria-expanded="true"
									class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn"
								>
									Podcast <span class="caret"></span>

								</button>

								<ul
									class="dropdown-menu"
									aria-labelledby="Podcasts"
								>
									<li class="dropdown-header">What are you looking for?</li>
									<li><a href="https://s3-us-west-2.amazonaws.com/brendonq/Website/thisPodcast.html">This Month</a></li>
									<li><a href="https://s3-us-west-2.amazonaws.com/brendonq/Website/searchPodcast.html">Search</a></li>
								</ul>

							</li>
						</ul>
					</div>
				</nav>

			</section>
		</div>

<h1>DJs</h1>

<!-- ----------------------------------------------DYNAMODB--------------------------------------------- -->


	
<div id="fb-root"></div>

<br/>

<div class="row padding ">
	
		<button class = "navbutton btn-xlarge " id="login">Login To Facebook to Post! </button>

	
</div>


<!-- ----------------------------start of row -->	<div class="row">
	
	

<div class = "row">

<div class = "col-xs-3 padding" >
	What:
	<input id="keyValue" type="text" />
	<br /> 
</div>

<div class = "col-xs-3 padding" >
	
	Post Attribute:
	<input id="attributeText" type="text" />
	<br /> 
	
</div>	
	
<div class = "col-xs-3 padding" >
	
	Attribute Data:
	<input
		id="valueText"
		type="text"
	/>
	<br />
</div>	

	
</div>
	
	<div>
	
	<br/>
	
	<button class = "navbutton" id="updateThis">Add/Update Post</button>
	|
	<button class = "navbutton" id="getThis">Search For Post</button>
	|
	<button class = "navbutton" id="deleteThis">Delete Post</button>

	</div>
	


<!-- -----------------------------end of row --> </div>




											<!-- ^^^^^^^^^^^^^^^  -->
					<!-- -----------------------script STARTS here----------------- -->
											<!-- vvvvvvvvvvvvvvv  -->		


<script type="text/javascript">
        var fbUserId;
        var params;
        var keyText;
        var attText;
        var valText;
        var dynamodb = null;
        var docClient = null;
        var appId = '172385149876565'; //from facebook
        var roleArn = 'arn:aws:iam::446189674349:role/araDBRole'; //from AWS IAM
        var resultData = null;
        var dataRaw = "";
        var cocksucker = "";

   
        

document.getElementById('getThis').onclick = function () {
    dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
    docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
    keyText = document.getElementById("keyValue").value;
    attText = document.getElementById("attributeText").value;
    console.log("Key Value: ", keyText);
    console.log("Attribute: ", attText);
    params = {
        TableName: 'djTable',
        Key: {
            what: keyText
        },
        ProjectionExpression: "#a",
        ExpressionAttributeNames: {
            '#a': attText
        }
    };
    docClient.get(params, function (err, data) {
        if (err) { 	
        	console.log(err, err.stack);
      			 }
        
        else 
        {
        	console.log("success, logging data: ");
        	console.log(data);//shows keys
        	console.log("attribute 1 is " + data.Item.attribute1)
        	//var output = data.Item.attribute1;
        	l = document.getElementById("output");
        	l.innerHTML = data.Item.attribute1;
        }
    })
};

document.getElementById('updateThis').onclick = function () {
    dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
    docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
    keyText = document.getElementById("keyValue").value;
    attText = document.getElementById("attributeText").value;
    valText = document.getElementById("valueText").value;
    console.log("Key Value: ", keyText);
    console.log("Attribute: ", attText);
    console.log("Value: ", valText);
    params = {
        TableName: 'djTable',
        Key: {
        	"what":"house party",

        },
        ExpressionAttributeNames: {
        	"#a": "when"
        },
        ExpressionAttributeValues: {
            ':v': valText
        },
        UpdateExpression: 'set #a = :v',
    };

    docClient.update(params, function (err, data) {
        if (err) console.log(err);
        else console.log(data);
    })
};

document.getElementById('deleteThis').onclick = function () {
    dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
    docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
    keyText = document.getElementById("keyValue").value;
    console.log("Key Value: ", keyText);
    params = {
        TableName: 'djTable',
        Key: {
            what: keyText        }
    };
    docClient.delete(params, function(err, data){
    if(err) console.log(err);
    else console.log(data);
    });
};

window.fbAsyncInit = function () {
    FB.init({ appId: appId });

    document.getElementById('login').onclick = function () {
    	
    	dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
        docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
    	

        FB.login(function (response) {
            if (response.authResponse) {
                AWS.config.credentials = new AWS.WebIdentityCredentials({ //WIF
                    RoleArn: roleArn,
                    ProviderId: 'graph.facebook.com',
                    WebIdentityToken: response.authResponse.accessToken
                });
            }
            else {
                console.log("Issue logging in");
            }

            // Load the FB JS SDK asynchronously
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) { return; }
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/all.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        })
        
            
///////////////////////////////////////////////////////////////IMPLEMENT THIS CODE


var params = {
    TableName: "djTable",
    KeyConditionExpression: "what = :whatQuery",
    ExpressionAttributeValues: {
        ":whatQuery": "house party"
    }
};
        
        

docClient.query(params, function(err, data) {
    if (err)
        console.log(JSON.stringify(err));
    else
    dataRaw += (JSON.stringify(data));  	
    
    dataRaw = dataRaw.slice(30,dataRaw.length-48);
	
	//Make the Data Sexier
	for(var i = 0; i<dataRaw.length; i++)
	{
		dataRaw = dataRaw.replace("link", "href=");
		dataRaw = dataRaw.replace(/["']/g, "");
		dataRaw = dataRaw.replace("{", " ");
		dataRaw = dataRaw.replace("},", "<br><br>");
		dataRaw = dataRaw.replace(",", "<br>");
		
	}

document.getElementById('demo2').innerHTML = dataRaw;
	
    
//document.getElementById("demo1").innerHTML = dataRaw;

});

/////////////////////////////////////////////////////////////// 

/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 




/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 
/////////////////////////////////////////////////////////////// 


    }  //this is where the facebook onclick function ends

}

</script>
											<!-- ^^^^^^^^^^^^^^^  -->
					<!-- -----------------------script ENDS here----------------- -->
											<!-- vvvvvvvvvvvvvvv  -->			




<!-- ----------------------------------------------PAGE CONTENT------------------------------------------------ -->

		


				<div class="row ">

				<section class="col-xs-12">
				
				<p id="demo2"></p>


				</section>
				</div>




	
	</div>

	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</body>
</html>