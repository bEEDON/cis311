<!DOCTYPE html>
<html>

   <!--
      Website  
      Author: Brendon Quaintance
      Date:   12-08-16
   -->


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/styles.css">
  
      <script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.18.min.js"></script>
    <script id="facebook-jssdk" src="https://connect.facebook.net/en_US/all.js"></script>
    <meta charset="UTF-8">
	
  <title>Frequently Asked Questions</title>
  
  <script type="text/javascript">
	function setCookie(cname, cvalue, exdays) {
                      var d = new Date();
                      d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                      var expires = "expires=" + d.toGMTString();
                      document.cookie = cname + "=" + cvalue + "; " + expires;
                  }

                  function getCookie(cname) {
                      var name = cname + "=";
                      var ca = document.cookie.split(';');
                      for (var i = 0; i < ca.length; i++) {
                          var c = ca[i];
                          while (c.charAt(0) == ' ') c = c.substring(1);
                          if (c.indexOf(name) != -1) {
                              return c.substring(name.length, c.length);
                          }
                      }
                      return "";
                  }
                     
                  
	</script>
 
</head>
<body class = "bgimagepage">

<nav class="bgimage navbar navbar-default navbar-fixed-top">
  <div class="container">
    <ul class="nav navbar-nav">

				
      <li ><br><br>
      
      
<button type="button" onclick = "location.href='index.html';" id = "Home"
					aria-haspopup="true" aria-expanded="true"
					class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn">Home
					
					
</button>
      
      
      </li>
      <li class="dropdown"><br><br>

					<button type="button" data-toggle = "dropdown" id = "About"
					aria-haspopup="true" aria-expanded="true"
					class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn">About
					<span class="caret"></span>
					
					</button>

					<ul class = "dropdown-menu" aria-labelledby = "About">
					
						<li class = "dropdown-header"></li>
						<li><a href="about.html">About Us</a></li>
						<li><a href="legal.html">Legal</a></li>
						<li><a href="faq.html">FAQ</a></li>
					
					</ul>
      </li>
      <li class="dropdown"><br><br>

					<button type="button" data-toggle = "dropdown" id = "Category"
					aria-haspopup="true" aria-expanded="true"
					class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn">Go To
					<span class="caret"></span>
					
					</button>

					<ul class = "dropdown-menu" aria-labelledby = "Category">
						<li class = "dropdown-header">What are you looking for?</li>
						<li><a href="#">Tonight</a></li>
						<li><a href="#">Tomorrow</a></li>
						<li><a href="#">Concerts</a></li>
						<li><a href="#">Bars / Clubs</a></li>
						<li><a href="#">House Parties</a></li>
				 		<li><a href="#">Pool Parties</a></li>
						<li><a href="#">Even Ratio</a></li>
						<li><a href="#">21 & Over</a></li>
						<li><a href="#">Members Only</a></li>
						<li><a href="#">? Secret</a></li>
						<li><a href="proof.html">Proof</a></li>
						<li><a href="map.html">Map</a></li>
						<li><a href="hosts.html">Hosts</a></li>
						<li><a href="security.html">Security</a></li>
						<li><a href="djs.html">DJs</a></li>
						<li><a href="chat.html">Chat</a></li>
					</ul>

      </li> 
      
      <li><br><br>
      
      	<button type="button" data-toggle = "dropdown" id = "Podcast"
					aria-haspopup="true" aria-expanded="true"
					class="navbutton btn-xlarge btn btn-info dropdown-toggle navbar-btn">Podcast
					<span class="caret"></span>
					
		</button>
		
		<ul class = "dropdown-menu" aria-labelledby = "Podcasts">
						<li><a href="thisPodcast.html">This Month's Podcasts</a></li>
						<li><a href="searchPodcast.html">Search for Podcast</a></li>
					</ul>
      
      </li>
    </ul>    
	<div align ="right"><br><br>
		<button id="login" style="display:inline" >Login</button>
		<button id="logout" style="display:none">Logout</button>
		</div>
  </div>
</nav>

<div class="content container">
  <div class="row ">
    <section class="col-xs-12">

	
	
<div class = "titlefont">

<h2>Billy Bronco Functions</h2>
</div>



<div id="fb-root"></div>

	<div style="display:none"><button id="getThis">Get!</button> | <button id="updateThis">Update!</button> | <button id="deleteThis">Delete!</button> | <button id="">Submit</button></div>
	
	
		<div align ="center">
	<fieldset id="field" align="center">
     <div align="center">

	<form name="input" action="javascript:put();" onsubmit="return validate_Form()" method="get" id="signupform" >
		<h3>Frequently Asked Questions</h3>
		<div id="body" style="color: #FFFFFF" >
		
		Please Log in to view frequently asked questions.</div>
		
		<h3>Have a question? Ask us!</h3>
		Name: <input id="name" type="text" style="color: #000000" /><br />
		Email: <input id="email" type="text" style="color: #000000"/><br /><br>
		Question: <textarea id="question" type="text" style="color: #000000" rows="4" cols="50"/></textarea><br />
		<input id="putThis" type="submit" value="Submit Question" style="color: #000000" />
		<script>document.getElementById("name").style.borderColor = 'black';
				document.getElementById("email").style.borderColor = 'black';
				document.getElementById("question").style.borderColor = 'black';
				document.getElementById("field").style.width = "400px";
				setCookie("login", "no", 30);

		</script>
		<br><br>
		</div>
	</fieldset>
	</form>
	</div>


<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">
                     
                  
        var fbUserId;
        var params;
        var name; //name
        var email; //att1
		var question; //att2
        var dynamodb = null;
        var docClient = null;
        var appId = '852908834733339'; //from facebook
        var roleArn = 'arn:aws:iam::801641316967:role/role3'; //from AWS IAM
        var resultData = null;

		
		function put() {
				dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
				docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
				name = document.getElementById("name").value;
				email = document.getElementById("email").value;
				question = document.getElementById("question").value;
				
				//log to console
				console.log("Name: ", name);
				console.log("Email: ", email);
				console.log("Question: ", question);
				
				params = {
					TableName: 'SubmittedQuestions',
					Item: {
						Name: name,
						Email: email,
						Question: question
					}
				};
				docClient.put(params, function(err, data){
					if (err) console.log(err);
					else
					{
						resultData = data;
						console.log(resultData);
						alert("Thank you for submitting your question. We will try to respond and answer your question as soon as we can.");
						
						//clear fields
						document.getElementById("name").value = "";
						document.getElementById("email").value = "";;
						document.getElementById("question").value = "";
						
						window.location.href='fag.html';
						}
					})		
			
		
		
		};

	 function validate_Form() {
		var nameArr = document.forms["input"]["name"].value;
		var emailArr = document.forms["input"]["email"].value.match(/^\s*[A-Za-z0-9!@#$%^&*()_+-=]+[@][A-Za-z0-9!@#$%^&*()_+-=]+[.][A-Za-z]{3}\s*$/);
		var questionArr = document.forms["input"]["question"].value;
		
		//check to see if logged in
		var check = getCookie("login");
		if (check == "yes") {
			
			//Validate Name
			if (nameArr != "") {
				document.getElementById("name").style.borderColor = 'black';
				document.getElementById("name").style.backgroundColor = "white";
			} else {
				alert("Please enter a name");
				document.getElementById("name").style.borderColor = '#FF0000';
				return false;
			}
			
			//Validate Email
			if (emailArr != null) {
				document.getElementById("email").style.borderColor = 'black';
				document.getElementById("email").style.backgroundColor = "white";
			} else {
				alert("You have entered an invalid email");
				document.getElementById("email").style.borderColor = '#FF0000';
				return false;
			}
			
			//Validate Question
			if (questionArr != "") {
				document.getElementById("question").style.borderColor = 'black';
				document.getElementById("question").style.style.backgroundColor = "white";
				return true;
			} else {
				alert("Please enter a question");
				document.getElementById("question").style.borderColor = '#FF0000';
				return false;
			}
		
		}else{
			alert("Please log in to submit a question.");
			return false;
			}
    };

	
	document.getElementById('getThis').onclick = function () {

				dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
				docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
				name = document.getElementById("keyValue").value;
				question = document.getElementById("attributeText").value;
				console.log("Key Value: ", name);
				console.log("Attribute: ", question);
				params = {
					TableName: 'SubmittedQuestions',
					Key: {
						itemID: name
					},
					ProjectionExpression: "#a",
					ExpressionAttributeNames: {
						'#a': question
					}
				};
				docClient.get(params, function (err, data) {
					if (err) console.log(err, err.stack);
					else console.log(data);
				})
			
	};


	document.getElementById('updateThis').onclick = function () {
		dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
		docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
		name = document.getElementById("keyValue").value;
		question = document.getElementById("attributeText").value;
		email = document.getElementById("valueText").value;
		console.log("Key Value: ", name);
		console.log("Attribute: ", question);
		console.log("Value: ", email);
		params = {
			TableName: 'SubmittedQuestions',
			Key: {
				itemID: name
			},
			ExpressionAttributeNames: {
				'#a': question
			},
			ExpressionAttributeValues: {
				':v': email
			},
			UpdateExpression: 'set #a = :v',
		};
		docClient.update(params, function (err, data) {
			if (err) console.log(err);
			else console.log(data);
		})
	};


	document.getElementById('deleteThis').onclick = function () {
		dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
		docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
		name = document.getElementById("keyValue").value;
		console.log("Key Value: ", name);
		params = {
			TableName: 'SubmittedQuestions',
			Key: {
				itemID: name
			}
		};
		docClient.delete(params, function(err, data){
		if(err) console.log(err);
		else console.log(data);
		});
	};

	//============ LOGGIN IN ================================
	function login()
	{
			//alert("Welcome!");
			setCookie("login", "yes", 30);
			//============ GET TABLE DATA ================================
			dynamodb = new AWS.DynamoDB({ region: 'us-west-2' });
			docClient = new AWS.DynamoDB.DocumentClient({ service: dynamodb });
			var data = "";
			
			var params = {
				TableName: "PublishedQuestions"
			};

			docClient.scan(params, function(err, data) {
				if (err)
					console.log(JSON.stringify(err, null, 2));
				else
				{
					//Read in data from Dynamo and trim length
					data += (JSON.stringify(data, null, 2));
					data = data.slice(30,data.length-48);
					
					//Make the Data Sexier
					for(var i = 0; i<data.length; i++)
					{
						data = data.replace(/["']/g, "");
						data = data.replace("{", " ");
						data = data.replace("},", "<br><br>");
						data = data.replace(",", "<br>");
						
					}
					
					//Output data to HTML page
					document.getElementById('body').innerHTML = data;
					document.getElementById('body').style.align = "left";
				}
			})
			
			//Hide login button and show logout if logged in
			document.getElementById("logout").style.display = "inline";
			document.getElementById("login").style.display = "none";

	};

	//============ LOGGIN OUT ================================
	document.getElementById('logout').onclick = function (){

		var answer = confirm("Are you sure you want to log out?")
		  if (answer) {
			setCookie("login", "no", 30);
			  document.getElementById('body').innerHTML = "Please Log in to view frequently asked questions.";
			  FB.logout(function(response) {});
			
			//Hide login button and show logout if logged in
				document.getElementById("login").style.display = "inline";
				document.getElementById("logout").style.display = "none";
		  }
		
	};

	window.fbAsyncInit = function () {
		FB.init({ appId: appId });
			FB.login(function (response) {
				if (response.authResponse) {
					AWS.config.credentials = new AWS.WebIdentityCredentials({ //WIF
						RoleArn: roleArn,
						ProviderId: 'graph.facebook.com',
						WebIdentityToken: response.authResponse.accessToken
					});

					login();
				}
				else {
					console.log("Issue logging in");
				}
				// Load the FB JS SDK asynchronously
				(function (d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) { return; }
					js = d.createElement(s); js.id = id;
					js.src = "https://connect.facebook.net/en_US/all.js";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			})
		
	}
	
	document.getElementById('login').onclick = function () {
		FB.init({ appId: appId });
			FB.login(function (response) {
				if (response.authResponse) {
					AWS.config.credentials = new AWS.WebIdentityCredentials({ //WIF
						RoleArn: roleArn,
						ProviderId: 'graph.facebook.com',
						WebIdentityToken: response.authResponse.accessToken
					});

					login();
				}
				else {
					console.log("Issue logging in");
				}
				// Load the FB JS SDK asynchronously
				(function (d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) { return; }
					js = d.createElement(s); js.id = id;
					js.src = "https://connect.facebook.net/en_US/all.js";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			})
		}
</script>

</body>
</html>
			
</body>
</html>